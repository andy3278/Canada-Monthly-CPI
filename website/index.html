<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Canada CPI Trend Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body {
        font-family: 'Open Sans', sans-serif;
    }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    .grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
    }
    .card {
        background: #fff;
        border: 1px solid #e1e1e1;
        padding: 20px;
    }
    .card-header {
        font-weight: 600;
        margin-bottom: 10px;
    }
    .chart-container {
        height: 0;
        padding-bottom: 50%;
        position: relative;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    table, th, td {
        border: 1px solid #e1e1e1;
    }
    th, td {
        padding: 8px;
        text-align: left;
    }
    th {
        background-color: #f8f8f8;
    }
</style>
    </head>
<body>
    <div class="container">
    <h1>Canada CPI Trend</h1>
    <div id="latestData">Last update: | Latest data: </div>
    <div class="grid">
        <div class="card" style="grid-column: span 2;">
        <div class="card-header">KPI 1</div>
        <!-- KPI 1 content goes here -->
        </div>
        <div class="card" style="grid-column: span 2;">
        <div class="card-header">KPI 2</div>
        <!-- KPI 2 content goes here -->
        </div>
        <div class="card" style="grid-column: span 2;">
        <div class="card-header">KPI 3</div>
        <!-- KPI 3 content goes here -->
        </div>
        <div class="card" style="grid-column: span 4;">
        <div class="card-header">Table</div>
        <table id="data-table">
            <thead>
            <tr>
                <th>Month</th>
                <th>CPI Value</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>January</td>
                <td>100</td>
            </tr>
            <!-- More rows go here -->
            </tbody>
        </table>
        </div>
        <div class="card" style="grid-column: span 7;">
        <div class="card-header"></div>
        <div class="chart-container">
            <select id="lineSelector">
                <option value="All">All</option>
                <option value="All items">All items</option>
                <option value="Food">Food</option>
                <option value="Shelter">Shelter</option>
                <option value="Household">Household</option>
                <option value="Clothing">Clothing</option>
                <option value="Transportation">Transportation</option>
                <option value="Health">Health</option>
                <option value="Recreation">Recreation</option>
                <option value="Alcohol-tobacco-cannabis">Alcohol-tobacco-cannabis</option>
            </select>
            <canvas id="cpiChart"></canvas>
        </div>
        </div>
    </div>
    </div>

    <script>
        // Load your JSON data
        fetch('../data/Canada_CPI_11012022_11012023.json')
            .then(response => response.json())
            .then(data => {
                // Extract the months and CPI values from the data
                const months = data.map(item => new Date(item.Date).toLocaleDateString());

                const allItems = data.map(item => item['All-items']);
                const food = data.map(item => item['Food']);
                const shelter = data.map(item => item['Shelter']);
                const household = data.map(item => item['Household']);
                const clothing = data.map(item => item['Clothing']);
                const transportation = data.map(item => item['Transportation']);
                const health = data.map(item => item['Health']);
                const recreation = data.map(item => item['Recreation']);
                const alcohol = data.map(item => item['Alcohol-tobacco-cannabis']);
                // Get the context of the canvas element we want to select
                var ctx = document.getElementById('cpiChart').getContext('2d');
        
                // Create the line chart
                var myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'All items',
                            data: allItems,
                            backgroundColor: '#F94144',
                            borderColor: '#F94144',
                            borderWidth: 1,
                            hidden: false
                        },
                        {
                            label: 'Food',
                            data: food,
                            backgroundColor: '#F3722C',
                            borderColor: '#F3722C',
                            borderWidth: 1,
                            hidden: false
                        },
                        {
                            label: 'Shelter',
                            data: shelter,
                            backgroundColor: '#cca000',
                            borderColor: '#cca000',
                            borderWidth: 1,
                            hidden: false
                        },
                        {
                            label: 'Household',
                            data: household,
                            backgroundColor: '#90BE6D',
                            borderColor: '#90BE6D',
                            borderWidth: 1,
                            hidden: true
                        },
                        {
                            label: 'Clothing',
                            data: clothing,
                            backgroundColor: '#43AA8B',
                            borderColor: '#43AA8B',
                            borderWidth: 1,
                            hidden: true
                        },
                        {
                            label: 'Transportation',
                            data: transportation,
                            backgroundColor: '#577590',
                            borderColor: '#577590',
                            borderWidth: 1,
                            hidden: true
                        },
                        {
                            label: 'Health',
                            data: health,
                            backgroundColor: '#277DA1',
                            borderColor: '#277DA1',
                            borderWidth: 1,
                            hidden: true
                        },
                        {
                            label: 'Recreation',
                            data: recreation,
                            backgroundColor: '#c200fb',
                            borderColor: '#c200fb',
                            borderWidth: 1,
                            hidden: true
                        },
                        {
                            label: 'Alcohol-tobacco-cannabis',
                            data: alcohol,
                            backgroundColor: '#220901',
                            borderColor: '#220901',
                            borderWidth: 1,
                            hidden: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Canada CPI Trend'
                            }
                        }
                    }
                });
                
                document.getElementById('lineSelector').addEventListener('change', function() {
                    var selectedOption = this.value;

                    // Update the 'hidden' property of each dataset depending on the selected option
                    myChart.data.datasets.forEach(function(dataset) {
                        if (selectedOption === 'All') {
                            dataset.hidden = false;
                        } else {
                            dataset.hidden = dataset.label !== selectedOption;
                        }
                    });

                    // Update the chart to reflect the changes to the datasets
                    myChart.update();
                });
                var latestDataDiv = document.getElementById('latestData');
                var latestDate = new Date(Math.max.apply(null, data.map(item => item.Date)));
                // Convert the latest date to a string in the ISO 8601 format and extract just the date part
                var latestDateString = latestDate.toISOString().substring(0, 10);
                // find latest update date
                var now = new Date();
                var latestUpdate = new Date(now.getFullYear(), now.getMonth(), 25)
                // if today is before the 25th, then the latest update is last month
                if (now.getDate() <= 25) {
                    latestUpdate.setMonth(latestUpdate.getMonth() - 1);
                }
                var latestUpdateString = latestUpdate.toISOString().substring(0, 10);
                latestDataDiv.textContent = `Last update: ${latestUpdateString} | Latest data: ${latestDateString}`;
            });
        
    </script>
</body>
</html>